<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Experimence accumulation from yum source | Kidlo-th</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Experimence accumulation from yum source" />
<meta name="author" content="Kidlo-th" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Record of errors and solutions for the yum source. Due to the inability to directly access the external network within the company, Yum source machines were established within the company to access the internal machines through software packages." />
<meta property="og:description" content="Record of errors and solutions for the yum source. Due to the inability to directly access the external network within the company, Yum source machines were established within the company to access the internal machines through software packages." />
<link rel="canonical" href="http://0.0.0.0:4000/technical/2024/05/23/Experiment-accumulation-from-yum-source.html" />
<meta property="og:url" content="http://0.0.0.0:4000/technical/2024/05/23/Experiment-accumulation-from-yum-source.html" />
<meta property="og:site_name" content="Kidlo-th" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-05-23T20:11:20+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Experimence accumulation from yum source" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Kidlo-th"},"dateModified":"2024-05-23T20:11:20+08:00","datePublished":"2024-05-23T20:11:20+08:00","description":"Record of errors and solutions for the yum source. Due to the inability to directly access the external network within the company, Yum source machines were established within the company to access the internal machines through software packages.","headline":"Experimence accumulation from yum source","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/technical/2024/05/23/Experiment-accumulation-from-yum-source.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/assets/img/fav.jpg"},"name":"Kidlo-th"},"url":"http://0.0.0.0:4000/technical/2024/05/23/Experiment-accumulation-from-yum-source.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=785f1c9571cf75fad2b6993ba8645f31bfa5c2c6">
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Favicon -->
    <link rel="icon" href="/assets/img/fav.jpg" type="image/jpg">

    <!-- For MathJax -->
    
      <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-MML-AM_CHTML"></script>
    

  </head>
  <body>
    <div class="wrapper">
      <header>
        <div id="header-upper">
          <h1 id="site-title-box"><a id="site-title" href="http://0.0.0.0:4000/">Kidlo-th</a></h1>
          
          
          <span id="site-logo-box">
            <img id="site-logo" src="/assets/img/fav.jpg" alt="Logo" />
          </span>
          

          <p id="site-description">
            Chase everything you love in life.
            <!--<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-lightning-charge" viewBox="0 0 16 16">
              <path d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09zM4.157 8.5H7a.5.5 0 0 1 .478.647L6.11 13.59l5.732-6.09H9a.5.5 0 0 1-.478-.647L9.89 2.41 4.157 8.5z"/>
            </svg>-->
          </p>
        </div>

        <div id="header-lower">
          <p class="view">
            <a href="https://github.com/kidlo-th">
              Find me on GitHub<br>
              <small>https://github.com/kidlo-th</small>
            </a>
          </p>


          <p class="view">
            <table class="emailtable">
              <tr class="emailtable">
                <td class="emailtable emailtable-icon" rowspan="2">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-envelope" viewBox="0 0 16 16">
                    <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z"/>
                  </svg>
                </td>
                <td class="emailtable"><i>uingfour@gmail.com</i></td>
              </tr>
              <tr class="emailtable">
                <td class="emailtable"><i></i></td>
              </tr>
            </table>
          </p>
        </div>
        
        <p id="header-bottom">
          <small>GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small>
        </p>
      </header>
      <section>

      <h1>Experimence accumulation from yum source</h1>
<p>23 May 2024 - Kidlo-th</p>

<p class="navigation-bar">
  <a href="/archive.html">Back to List of Archive</a>
</p>

<p>Record of errors and solutions for the yum source. Due to the inability to directly access the external network within the company, Yum source machines were established within the company to access the internal machines through software packages.</p>

<h1 id="é—®é¢˜redhatä¸»æœºä½¿ç”¨centos--yumæº"><strong>é—®é¢˜ï¼šRedhatä¸»æœºä½¿ç”¨CentOS  Yumæº</strong></h1>

<h2 id="é—®é¢˜æè¿°"><strong>é—®é¢˜æè¿°</strong></h2>

<p>åœ¨Redhatä¸»æœºä¸Šä½¿ç”¨CentOS Yumæº(å…¶Yumæºä¸ºå†…ç½‘æ­å»º)æ—¶ï¼Œ<code class="language-plaintext highlighter-rouge">yum clean all</code>æ—¶æŠ¥é”™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>......
http://192.168.33.128/centos/7Server/os/x86_64/latest/repodata/repomd.xml: <span class="o">[</span>Errno 14] HTTP Error 404 - Not Found
......
</code></pre></div></div>

<h2 id="æ’æŸ¥è¿‡ç¨‹"><strong>æ’æŸ¥è¿‡ç¨‹</strong></h2>

<p>1ã€æ£€æŸ¥ç½‘ç»œæ˜¯å¦äº’é€š - äº’é€šï¼›
2ã€æ£€æŸ¥repoæ–‡ä»¶æ˜¯å¦æœ‰é”™è¯¯ - æœªå‘ç°é”™è¯¯ï¼›
3ã€æ ¹æ®æŠ¥é”™ä¿¡æ¯å‘ç°URLä¸­<code class="language-plaintext highlighter-rouge">$releaserver</code>å˜é‡è·å–çš„å€¼ä¸º<code class="language-plaintext highlighter-rouge">7Server</code>ï¼Œè€Œæ­£å¸¸åº”è¯¥ä¸º<code class="language-plaintext highlighter-rouge">7</code>ï¼Œæ‰€ä»¥URLæ‹¼å†™é”™è¯¯å¯¼è‡´<code class="language-plaintext highlighter-rouge">Not Found</code>ã€‚</p>

<h2 id="è§£å†³æ–¹æ³•"><strong>è§£å†³æ–¹æ³•</strong></h2>

<p>é‡æ–°ç¼–è¾‘<code class="language-plaintext highlighter-rouge">xxxx.repo</code>æ–‡ä»¶ï¼Œä½¿ç”¨<code class="language-plaintext highlighter-rouge">%s/$releaserver/7/g</code>å°†å…¶ä¸­çš„<code class="language-plaintext highlighter-rouge">$releaserver</code>å˜é‡ä¿®æ”¹ä¸ºå¸¸é‡ï¼Œé‡æ–°<code class="language-plaintext highlighter-rouge">yum clean all &amp;&amp; yum makecache</code>ã€‚</p>

<h2 id="è¡ç”Ÿ"><strong>è¡ç”Ÿ</strong></h2>

<p>åœ¨å¤„ç†ä»¥ä¸Šé—®é¢˜æ˜¯ï¼Œå‘ç°äº†å¦ä¸€ä¸ªé—®é¢˜ã€‚
ç°è±¡1ï¼šredhatä¸»æœº<code class="language-plaintext highlighter-rouge">/etc/yum.repo.d</code>ä¸‹æœ‰ä¸ª<code class="language-plaintext highlighter-rouge">redhat.repo</code>çš„æ–‡ä»¶æ— æ³•è¢«ä¿®æ”¹ï¼Œæ¯æ¬¡è¢«ä¿®æ”¹åéƒ½ä¼šæ¢å¤åŸæœ‰å†…å®¹ã€‚
ç°è±¡2ï¼šæ¯æ¬¡<code class="language-plaintext highlighter-rouge">yum clean all</code>æ—¶éƒ½ä¼šæŠ¥ä¸€ä¸ªä»¥ä¸‹æ‰€ç¤ºçš„é”™è¯¯</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>This system is not registered with an entitlement server. You can use subscription-manager to register.
æ­¤ç³»ç»Ÿæœªå‘æˆæƒæœåŠ¡å™¨æ³¨å†Œã€‚æ‚¨å¯ä»¥ä½¿ç”¨è®¢é˜…ç®¡ç†å™¨è¿›è¡Œæ³¨å†Œã€‚
</code></pre></div></div>

<p>åœ¨ç½‘ä¸Šæœç´¢ä¹‹åå‘ç°åŸå› ï¼š
	redhatè‡ªå¸¦çš„æ’ä»¶<code class="language-plaintext highlighter-rouge">subscription-manager</code>ã€‚è¿™ä¸ªæ’ä»¶çš„ä½œç”¨å°±æ˜¯<code class="language-plaintext highlighter-rouge">Red Hat Subscription Manager</code>è®¢é˜…ç®¡ç†å™¨ï¼Œå®ƒä¼šä¸€ç›´å°†æç¤ºä½ registerï¼Œè€Œä¸”ä¼šæ›´æ–°æˆ–è€…é‡ç½®<code class="language-plaintext highlighter-rouge">redhat.repo</code>æ–‡ä»¶ï¼Œä½†æ˜¯ä¸å½±å“yumä½¿ç”¨ï¼Œå¦‚æœä¸æƒ³çœ‹åˆ°æç¤ºï¼Œå°±éœ€è¦æ‰‹åŠ¨å…³é—­</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/yum/pluginconf.d/subscription-manager.conf

<span class="o">[</span>main]
<span class="c"># enabled=1 </span>
<span class="c"># é™¤ä»¥ä¸Šæ³¨é‡Šæ‰ï¼Œè¿˜å¯ä»¥ä¿®æ”¹ä¸ºenabled=0</span>
</code></pre></div></div>

<h1 id="é—®é¢˜æŠ¥é”™errorrpmdb-open-failed">é—®é¢˜ï¼šæŠ¥é”™Errorï¼šrpmdb open failed</h1>

<h2 id="é—®é¢˜æè¿°-1"><strong>é—®é¢˜æè¿°</strong></h2>

<p>åœ¨centosæœºå™¨ä¸Šå®‰è£…<code class="language-plaintext highlighter-rouge">net-tools</code>æ—¶ï¼Œå¡åœ¨æœç´¢åŒ…è¿›ç¨‹ï¼Œå¼ºåˆ¶killæ‰yumè¿›ç¨‹ä¹‹åï¼Œå†æ¬¡å°è¯•åˆ™æŠ¥ä»¥ä¸‹æŠ¥é”™<code class="language-plaintext highlighter-rouge">Error: rpmdb open failed</code></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@localhost excalidraw]# yum <span class="nt">-y</span> <span class="nb">install </span>net-tools
Failed to <span class="nb">set </span>locale, defaulting to C
error: rpmdb: BDB0113 Thread/process 114309/139749749523712 failed: BDB1507 Thread died <span class="k">in </span>Berkeley DB library
error: db5 error<span class="o">(</span><span class="nt">-30973</span><span class="o">)</span> from dbenv-&gt;failchk: BDB0087 DB_RUNRECOVERY: Fatal error, run database recovery
error: cannot open Packages index using db5 -  <span class="o">(</span><span class="nt">-30973</span><span class="o">)</span>
error: cannot open Packages database <span class="k">in</span> /var/lib/rpm
CRITICAL:yum.main:

Error: rpmdb open failed
</code></pre></div></div>

<h2 id="æ’æŸ¥è¿‡ç¨‹-1"><strong>æ’æŸ¥è¿‡ç¨‹</strong></h2>

<p>é¦–å…ˆäº†è§£ä¸€ä¸‹rpmdbæ˜¯ä»€ä¹ˆï¼Œrpmdbæ˜¯è®°å½•ç³»ç»Ÿä¸­å·²å®‰è£…çš„æ‰€æœ‰RPMåŒ…ä¿¡æ¯çš„æœ¬åœ°æ•°æ®åº“ï¼Œå¯ä»¥é€šè¿‡rpmdbæ¥æŸ¥è¯¢ã€ç®¡ç†è½¯ä»¶åŒ…ã€‚åœ¨CentOSï¼Œé€šå¸¸æŠ¥é”™<code class="language-plaintext highlighter-rouge">Error: rpmdb open failed</code>å°±æ˜¯rpmdbæ•°æ®å´©æºƒäº†ï¼Œæ— æ³•æ­£å¸¸ä½¿ç”¨ã€‚</p>

<p>RPMDBæ•°æ®åº“çš„ä½ç½®ä¸€èˆ¬åœ¨<code class="language-plaintext highlighter-rouge">/var/lib/rpm/</code>ä¸‹(å³__db.*)</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@localhost rpm]# <span class="nb">pwd</span>
/var/lib/rpm
<span class="o">[</span>root@localhost rpm]# <span class="nb">ls
</span>Basenames     Dirnames  Installtid  Obsoletename  Providename  Sha1header  Triggername  __db.002
Conflictname  Group     Name        Packages      Requirename  Sigmd5      __db.001     __db.003
</code></pre></div></div>

<h2 id="è§£å†³åŠæ³•"><strong>è§£å†³åŠæ³•</strong></h2>

<p>å½“ç¢°åˆ°è¿™ç§æŠ¥é”™çš„æ—¶å€™ï¼Œå¯ä»¥åˆ é™¤æ—§çš„RPMDBé‡Œçš„æ•°æ®åº“ï¼Œç„¶åé‡å»º</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># è¿›å…¥RPMDBæ•°æ®åº“æ‰€åœ¨ç›®å½•</span>
<span class="o">[</span>root@localhost ~]# <span class="nb">cd</span> /var/lib/rpm
<span class="c"># åˆ é™¤æ—§æ•°æ®åº“</span>
<span class="o">[</span>root@localhost rpm]# <span class="nb">rm</span> <span class="nt">-rf</span> __db.<span class="k">*</span>
<span class="c"># é‡å»ºRPMDBæ•°æ®åº“</span>
<span class="o">[</span>root@localhost rpm]# rpm <span class="nt">--rebuilddb</span>
<span class="c"># æ¸…é™¤Yumç¼“å­˜</span>
<span class="o">[</span>root@localhost rpm]# yum clean all
Failed to <span class="nb">set </span>locale, defaulting to C
??????fastestmirror
æ­£åœ¨æ¸…ç†è½¯ä»¶æºï¼š base centos-sclo-rh centos-sclo-sclo epel extras galaxy4-rhel7 mongodb-org updates
Cleaning up list of fastest mirrors
</code></pre></div></div>



<p class="navigation-bar">
  <a href="/archive.html">Back to List of Archive</a>
</p>


<p><strong>Please comment below anything you wanna say! ğŸ˜‰</strong></p>

<!-- For Utterance comments -->
<script src="https://utteranc.es/client.js"
        repo="josehu07/josehu07.github.io"
        issue-term="pathname"
        label="UtterancesğŸ”®"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>


      <p class="navigation-bar">
        <script type="text/javascript">
          function topFunction() {
            document.body.scrollTop = 0; // For Safari
            document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
          }
        </script>
        <a href="javascript:topFunction();">Back to Top</a>
      </p>

      </section>
    </div>
    <script src="/assets/js/scale.fix.js"></script>
    
  </body>
</html>
